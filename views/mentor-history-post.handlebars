<div class="jumbotron jumbotron-title text-left" style="background-color: #e9ecef4f; box-shadow: 0px 3px 6px 0px #4441412b;">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="/mentor">Ask a Mentor</a></li>
        <li class="breadcrumb-item active" aria-current="page">View</li>
      </ol>
    </nav>

    <h1 class="display-3 d-none d-sm-block">{{post.question}}</h1>
    <h1 class="display-4 d-sm-none">{{post.question}}</h1>
    <hr>

    <a href="/mentor/post"><p class="lead"><i class="fas fa-user-graduate"></i>  Personalized help from experienced Code Assist Mentors</p></a>
  </div>
</div>

<div class="container" id="mentor-post-body">
  <div class="list-group">

    <a class="list-group-item list-group-item-action flex-column align-items-start active">
      <div class="d-flex w-100 justify-content-between">
        <h3>{{post.question}}</h3>
        <small>{{post.author}}</small>
      </div>
    </a>

    <a class="list-group-item list-group-item-action flex-column align-items-start">
      <div class="d-flex w-100 justify-content-between">
        <p class="mb-1"><div id="post-view-editor" class="noborder"></div></p>
      </div>
    </a>

    {{#if post.files}}
    <div class="list-group-item list-group-item-action flex-column align-items-start">
      <div class="d-flex w-100 justify-content-between">
        {{#each post.files}}
        <a class="btn btn-primary" href="/mentor/file/{{this.fileID}}" role="button">{{this.name}}</a>
        {{/each}}
      </div>
    </div>
    {{/if}}

    <a class="list-group-item list-group-item-action flex-column align-items-start">
      <div class="d-flex w-100 justify-content-between">
        <small class="moment-timestamp">{{post.timestamp}}</small>
      </div>
    </a>

    {{#each post.answers}}
    <a class="list-group-item list-group-item-action flex-column align-items-start">
      <div class="d-flex w-100 justify-content-between">
        <h5> </h5>
        <small>{{this.author}}</small>
      </div>
      <p class="mb-1"><div class="quill-editor-view answer-view noborder"></div></p>
      <small class="moment-timestamp">{{this.timestamp}}</small>
    </a>
    {{/each}}
  </div>

  <form action="/" method="post">
    <div class="form-group">
      <label for="answer-editor">Description</label>
      <div id="answer-editor">

      </div>
    </div>

    <button class="btn btn-primary" id="submit">Post your answer</button>
  </form>

</div>

<div class="card">
  <div class="card-header">
    Featured
  </div>
  <div class="card-body">
    <h5 class="card-title">Special title treatment</h5>
    <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
    <a href="#" class="btn btn-primary">Go somewhere</a>
  </div>
</div>

<script type="text/javascript">
  window.onload = function(){
    /* Post Description Viewer (Quill) */
    var postViewEditor = new Quill('#post-view-editor', {
      modules: {
        toolbar: false
      },
      theme: 'snow'
    });
    postViewEditor.setContents({{{post.description}}});
    postViewEditor.disable();

    /* All of the Answers Viewer (Quill) */
    var answerViews = $('.answer-view');
    // console.log("#Answers: " + answerViews.length);
    var postAnswers = [];
    {{#each post.answers}}
    postAnswers.push({{{this.answer}}});
    {{/each}}
    for (var i = 0; i < answerViews.length; i++)
    {
      var answer = answerViews.get(i);
      var quill = new Quill(answer, {
        modules: {
          toolbar: false
        },
        theme: 'snow'
      });
      quill.setContents(postAnswers[i]);
      quill.disable();
    }


    /*New answer posting editor (Quill)
      Render saved data as well
    */

    var answerEditor = new Quill('#answer-editor', {
      modules: {
        toolbar: [
          [{ header: [1, 2, false] }],
          ['bold', 'italic', 'underline'],
          ['image', 'code-block']
        ]
      },
      theme: 'snow'
    });
    answerEditor.setContents({{{saved}}});

    $('#submit').on('click', function(event) {
      event.preventDefault();
      var answer = JSON.stringify(answerEditor.getContents().ops);
      console.log($(location).attr('pathname'));
      var post_url = "/mentor/history/{{post.id}}/answer";

      $.post(post_url, {answer: answer}, function(url) {
        window.location.replace(url);
      });
    });

    /*
    Moment Date format
    */
    $('.moment-timestamp').each(function() {
      var timestamp = new Date($(this).text());
      timestamp = moment(timestamp, "MM-DD");
      $(this).text("Posted " + timestamp.format("MMM D"));
    });
  };
</script>
